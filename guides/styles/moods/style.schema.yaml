# Style Schema
# Composed aggregate of spec files + user overrides
# Version: 0.1.0

_meta:
  description: Schema for style.yaml - the composed moodboard definition
  version: 0.1.0

# ============================================
# DIRECTIVES
# Comment-based override control (end-of-line)
# ============================================

directives:
  "# LOCKED":
    description: |
      Frozen value. Composition process preserves this field exactly.
      Use for user-defined values that should never change.
    example: |
      palette:
        primary: "#1A1918"  # LOCKED
    behavior: Skip during composition. Preserve exactly.

  "# IMPORTANT":
    description: |
      Priority value. Wins conflicts during composition.
      Still participates in aggregation but takes precedence.
    example: |
      spacing:
        base: 8  # IMPORTANT
    behavior: Override conflicting values from specs.

  scope: |
    Directives apply to the line they appear on.
    For nested structures, apply to leaf values:
      palette:
        primary: "#000"  # LOCKED
    Not to containers:
      palette:  # LOCKED (undefined behavior)

# ============================================
# PRESET FIELDS (Optional, semantics fixed)
# ============================================

presets:
  size:
    type: tuple[int, int]
    description: Target output dimensions (width, height)
    example: [1920, 1080]

  palette:
    type: object
    description: Color system
    fields:
      dominant: list[color_entry]
      accent: list[color_entry]
      neutral: list[color_entry]
      semantic:
        type: object
        description: Named color roles
        example:
          primary: "#133554"
          surface: "#FAF8F5"
          text: "#1A1918"

  typography:
    type: object
    description: Font system
    fields:
      families:
        type: list[font_entry]
      scale:
        type: list[float]
        description: Size scale (multipliers or absolute)
      weights:
        type: list[int]
        description: Available weights

  spacing:
    type: object
    description: Spatial system
    fields:
      base: int
      scale: list[int]
      philosophy: string

  composition:
    type: object
    description: Aggregate spatial properties
    fields:
      balance: float
      density: float
      rhythm: string

  texture:
    type: object
    description: Surface qualities
    fields:
      grain: float
      organic: float

  affect:
    type: object
    description: Aggregate felt qualities
    fields:
      temperature: float
      weight: float
      energy: float

# ============================================
# META FIELDS
# ============================================

meta:
  sources:
    type: list[string]
    description: Spec files that contributed to this style
    example: ["noir01.spec.yaml", "contrast.spec.yaml"]

  composed_at:
    type: datetime
    description: When composition last ran

  version:
    type: string
    description: Style version

# ============================================
# OPEN FIELDS
# ============================================

open:
  description: |
    User-defined fields. Anything goes.
    Useful for:
      - intent: "contemplative, urban decay"
      - anti_patterns: ["glossy", "corporate"]
      - inspiration: "Blade Runner meets Wabi-sabi"
      - constraints: ["no pure black", "max 3 colors"]
      - tokens: { custom CSS variable mappings }

# ============================================
# COMPOSITION RULES
# How specs aggregate into style
# ============================================

composition:
  colors:
    strategy: cluster_weighted
    description: |
      Cluster similar colors across specs.
      Weight by frequency and recency.
      Deduplicate within threshold (deltaE < 5).

  floats:
    strategy: weighted_mean
    description: |
      Average numeric values.
      Optional: weight recent specs higher.

  lists:
    strategy: union_dedupe
    description: |
      Combine lists, remove duplicates.
      Preserve order by first occurrence.

  conflict_resolution:
    - "# LOCKED fields are never modified"
    - "# IMPORTANT fields win conflicts"
    - "Most recent spec wins ties"
    - "User-added fields preserved"
